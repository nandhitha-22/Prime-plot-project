<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Upload and Manage Images</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ccc;
        }

        th {
            background-color: #f0f0f0;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Admin Panel - Upload Images</h1>

        <!-- Login Form -->
        <div id="loginForm" class="mb-4">
            <h3>Please Log In</h3>
            <form id="loginFormSubmit">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-primary">Log In</button>
            </form>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" style="display: none;">
            <div class="mb-4">
                <h3>Welcome, <span id="adminUsername"></span>!</h3>
            </div>

            <!-- Upload Section -->
            <div class="mb-4">
                <input type="file" id="imageUpload" multiple accept="image/*" class="form-control"
                    onchange="previewImage()" />

                <div class="mt-3">
                    <label for="plotName" class="form-label mt-2">Plot Name</label>
                    <input type="text" id="plotName" class="form-control" placeholder="Enter unique Plot Name" />

                    <label for="plotLocation" class="form-label">Location</label>
                    <input type="text" id="plotLocation" class="form-control" placeholder="Enter plot location" />

                    <label for="plotPrice" class="form-label mt-2">Price</label>
                    <input type="text" id="plotPrice" class="form-control" placeholder="Enter price" />

                    <label for="plotSize" class="form-label mt-2">Plot Size</label>
                    <input type="text" id="plotSize" class="form-control"
                        placeholder="Enter plot size (e.g., 1200 sq.ft)" />

                    <label for="plotEC" class="form-label mt-2">Upload EC Document (PDF or Image)</label>
                    <input type="file" id="plotEC" class="form-control" accept=".pdf,image/*" />
                </div>

                <div class="mt-3" id="imagePreview" style="display: none;">
                    <h4>Preview</h4>
                    <img id="previewImg" src="" alt="Image Preview" class="img-fluid mb-2" />
                    <button id="uploadBtn" class="btn btn-primary">Upload Image</button>
                </div>
                <br><br><br>
                <!-- Uploaded Images Section -->
                <h3>Uploaded Plots</h3>
                <div id="uploadedImages" class="row mt-3"></div>
            </div>
        </div>

        <!-- Logout Button -->
        <button id="logoutBtn" class="btn btn-danger position-fixed top-0 end-0 m-3"
            style="z-index: 1000; display: none;">
            Log Out
        </button>
    </div>

    <!-- Bootstrap & Custom Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="admin.js"></script>

    <script>
        document.getElementById("uploadBtn").addEventListener("click", function () {
            const plotName = document.getElementById("plotName").value.trim();
            const imageFile = document.getElementById("imageUpload").files[0];
            const location = document.getElementById("plotLocation").value.trim();
            const price = document.getElementById("plotPrice").value.trim();
            const size = document.getElementById("plotSize").value.trim();

            if (!plotName || !imageFile || !location || !price || !size) {
                alert("Please fill out all fields and select an image.");
                return;
            }

            const storedPlots = JSON.parse(localStorage.getItem("galleryImages")) || [];



            const reader = new FileReader();
            reader.onload = function (e) {
                const newPlot = {
                    plotName,
                    image: e.target.result,
                    location,
                    price,
                    size
                };

                storedPlots.push(newPlot);
                localStorage.setItem("galleryImages", JSON.stringify(storedPlots));

                alert("✅ Plot uploaded successfully!");
                document.getElementById("plotName").value = "";
                document.getElementById("imageUpload").value = "";
                document.getElementById("plotLocation").value = "";
                document.getElementById("plotPrice").value = "";
                document.getElementById("plotSize").value = "";
                document.getElementById("imagePreview").style.display = "none";

                displayUploadedImages();
            };

            reader.readAsDataURL(imageFile);
        });


        function previewImage() {
            const file = document.getElementById("imageUpload").files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById("previewImg").src = e.target.result;
                    document.getElementById("imagePreview").style.display = "block";
                };
                reader.readAsDataURL(file);
            }
        }

        function displayUploadedImages() {
            const uploadedImagesDiv = document.getElementById("uploadedImages");
            uploadedImagesDiv.innerHTML = "";
            const storedPlots = JSON.parse(localStorage.getItem("galleryImages")) || [];

            if (storedPlots.length === 0) {
                uploadedImagesDiv.innerHTML = "<p>No plots uploaded yet.</p>";
                return;
            }

            storedPlots.forEach((plot) => {
                const colDiv = document.createElement("div");
                colDiv.className = "col-md-4 mb-3";

                const card = document.createElement("div");
                card.className = "card";

                const img = document.createElement("img");
                img.src = plot.image;
                img.className = "card-img-top";

                const cardBody = document.createElement("div");
                cardBody.className = "card-body";

                cardBody.innerHTML = `
                  <p><strong>ID:</strong> ${plot.plotName}</p>
          <p><strong>Location:</strong> ${plot.location}</p>
          <p><strong>Price:</strong> ${plot.price}</p>
          <p><strong>Size:</strong> ${plot.size}</p>
        `;

                card.appendChild(img);
                card.appendChild(cardBody);
                colDiv.appendChild(card);
                uploadedImagesDiv.appendChild(colDiv);
            });
        }
    </script>




    <!-- Booking Section -->
    <h2 class="mt-5">Add New Booking</h2>
    <form id="bookingForm" class="row g-3 mb-4">
        <div class="col-md-3">
            <input type="text" class="form-control" id="newName" placeholder="Name" required>
        </div>
        <div class="col-md-3">
            <input type="email" class="form-control" id="newEmail" placeholder="Email" required>
        </div>
        <div class="col-md-2">
            <input type="text" class="form-control" id="newPhone" placeholder="Phone" required>
        </div>
        <div class="col-md-2">
            <input type="text" class="form-control" id="newPlot" placeholder="Plot Name" required>
        </div>
        <div class="col-md-2">
            <input type="text" class="form-control" id="newPrice" placeholder="Price" required>
        </div>
        <div class="col-md-2">
            <select class="form-select" id="newStatus" required>
                <option value="">Select Status</option>
                <option value="Paid">Paid</option>
                <option value="Pending">Pending</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary">Add Booking</button>
        </div>
    </form>

    <h2>📋 Admin Booking Dashboard</h2>
    <table class="table table-bordered" id="bookingTable">
        <thead>
            <tr>
                <th>Booking ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Plot Name</th>
                <th>Price</th>
                <th>Status</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    </div>

    <script>
        function renderBookings() {
            const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
            const tbody = document.querySelector("#bookingTable tbody");
            tbody.innerHTML = "";

            if (bookings.length === 0) {
                tbody.innerHTML = "<tr><td colspan='9' class='text-center'>No bookings found.</td></tr>";
                return;
            }

            bookings.forEach(b => {
                const row = `<tr data-id="${b.bookingId}">
              <td>${b.bookingId}</td>
              <td contenteditable="true">${b.name}</td>
              <td contenteditable="true">${b.email}</td>
              <td contenteditable="true">${b.phone}</td>
              <td contenteditable="true">${b.plotName}</td>
              <td contenteditable="true">${b.price}</td>
              <td contenteditable="true">${b.paymentStatus}</td>
              <td>${b.date}</td>
              <td>
                <button class="btn btn-sm btn-success save-btn">Save</button>
                <button class="btn btn-sm btn-danger delete-btn ms-1">Delete</button>
              </td>
            </tr>`;
                tbody.innerHTML += row;
            });
        }

        document.getElementById("bookingForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("newName").value.trim();
            const email = document.getElementById("newEmail").value.trim();
            const phone = document.getElementById("newPhone").value.trim();
            const plotName = document.getElementById("newPlot").value.trim();
            const price = document.getElementById("newPrice").value.trim();
            const paymentStatus = document.getElementById("newStatus").value;
            const date = new Date().toLocaleDateString();
            const bookingId = "BKG" + Date.now();

            const newBooking = {
                bookingId,
                name,
                email,
                phone,
                plotName,
                price,
                paymentStatus,
                date
            };

            const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
            bookings.push(newBooking);
            localStorage.setItem("bookings", JSON.stringify(bookings));
            alert("✅ Booking added!");
            renderBookings();
            e.target.reset();
        });

        document.querySelector("#bookingTable").addEventListener("click", function (e) {
            const row = e.target.closest("tr");
            const bookingId = row.getAttribute("data-id");

            if (e.target.classList.contains("save-btn")) {
                const cells = row.querySelectorAll("td");
                const updatedBooking = {
                    bookingId: bookingId,
                    name: cells[1].innerText.trim(),
                    email: cells[2].innerText.trim(),
                    phone: cells[3].innerText.trim(),
                    plotName: cells[4].innerText.trim(),
                    price: cells[5].innerText.trim(),
                    paymentStatus: cells[6].innerText.trim(),
                    date: cells[7].innerText.trim()
                };

                const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
                const index = bookings.findIndex(b => b.bookingId == bookingId);
                if (index !== -1) {
                    bookings[index] = updatedBooking;
                    localStorage.setItem("bookings", JSON.stringify(bookings));
                    alert("✅ Booking updated successfully!");
                }
            }

            if (e.target.classList.contains("delete-btn")) {
                if (confirm("Are you sure you want to delete this booking?")) {
                    let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
                    bookings = bookings.filter(b => b.bookingId != bookingId);
                    localStorage.setItem("bookings", JSON.stringify(bookings));
                    row.remove();
                    alert("🗑️ Booking deleted.");
                }
            }
        });

        renderBookings();
    </script>
</body>

</html>


<h3 class="mt-5">User Login History</h3>
<table class="table table-bordered" id="userLoginTable">
    <thead>
        <tr>
            <th>User ID</th>
            <th>Username</th>
            <th>Password</th>
            <th>Login Time</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    // ✅ Display Login History
    function displayUserLogins() {
        const loginTable = document.querySelector("#userLoginTable tbody");
        if (!loginTable) return;

        const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");

        if (loginHistory.length === 0) {
            loginTable.innerHTML = "<tr><td colspan='3'>No user logins yet.</td></tr>";
            return;
        }

        loginTable.innerHTML = "";
        loginHistory.forEach((log, index) => {
            loginTable.innerHTML += `
      <tr>
        <td>${index + 1}</td>
        <td>${log.username}</td>
        <td>${log.password}</td>
        <td>${log.time}</td>
      </tr>
    `;
        });
    }

    // Call on load
    displayUserLogins();

</script>
</body>

</html>
